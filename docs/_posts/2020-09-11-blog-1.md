---
layout: post
title:  "Operating Electronic Decices from a Web Browser"
date:   2020-09-10 22:24:26 -0700
categories: MicroPython
---

<h1><b>Intro</b></h1>

If you want to control electronics like motors or relays, you can do so by using MicroPython with an ESP8266 and a web browser.
MicroPython is one of the easier coding languages for beginners to program the ESP8266.

<h1><b>Requirements/tools</b></h1>
You can replace the below materials with your project needs, but for a simple example you would need the materials below;

D1 Mini board (or other ESP8266 or ESP32)
Breadboard
Relay
Motor with propeller
Jumpers
Micro-USB cable
9-volt battery
Battery connector

<h1><b>Step 1: Identify the Serial Port </b></h1>
In Linux system, plug in the ESP8266 and run the command below to find what it’s serial number.

To do so, open terminal and type:

{% highlight ruby %}

~$ dmesg | grep tty

{% endhighlight %}

You should see a result with “wch” in it and followed by a number, ex; wchusbserial14630

<h1>Step 2: Download the Latest MicroPython Binary</h1>
Download the latest firmware based on the board you’re using. find your board, and download the file. You can find the links below to the download for ESP8266 board or ESP32. When you select your board, choose the .bin file for the latest stable release.

{% highlight ruby %}
"https://micropython.org/download/esp8266/"
"https://micropython.org/download/esp32/"
{% endhighlight %}

<h1>Step 3: Erase the Board</h1>
Erase the board so that there are no issues when you flash MicroPython to it. Use the following command, remember to replace the serial number with your serial number;

{% highlight ruby %}

~$ esptool.py --port /dev/cu.wchusbserial14630 erase_flash

{% endhighlight %}

<h1>Step 4: Flash MicroPython</h1>
Now, if you're using an ESP8266 microcontroller, run the following to flash MicroPython over to it. Replace the .bin file at the end with the MicroPython binary you downloaded.

{% highlight ruby %}

~$ esptool.py --port /dev/cu.wchusbserial14630 --baud 460800 write_flash --flash_size=detect 0 /Users/kali/Downloads/esp8266-20191220-v1.12.bin

{% endhighlight %}

Once it's done flashing, you can confirm that it was done correctly by using the following command;

{% highlight ruby %}

~$ screen /dev/cu.wchusbserial14630 115200

{% endhighlight %}


<h1><b>Step 5: Installing Jupyter Notebook</b></h1>

Now, we need to get Jupyter Notebook on our computer, the web program we'll be using to have direct control over motors, relays, sensors, and other components.

First use the command below;
{% highlight ruby %}

~$ python3 -m pip install --upgrade pip

{% endhighlight %}

Then this command to install Jupyter;
{% highlight ruby %}

~$ python3 -m pip install jupyter

{% endhighlight %}

Now upgrade Jupyter;
{% highlight ruby %}

~$ pip3 install --upgrade jupyter_client

{% endhighlight %}

<h1><b>Step 6: Install the Jupyter Notebook MicroPython Kernel</b></h1>
We need to install the MicroPython kernel for Jupyter Notebook now. We can get it from the Jupyter MicroPython Kernel GitHub repo using;

{% highlight ruby %}

~$ git clone https://github.com/goatchurchprime/jupyter_micropython_kernel.git

{% endhighlight %}

Next, install it to Python3 with;
{% highlight ruby %}

~$ pip3 install -e jupyter_micropython_kernel

{% endhighlight %}

Now, install the kernel into Jupyter;
{% highlight ruby %}

~$ python3 -m jupyter_micropython_kernel.install

{% endhighlight %}

<h1><b>Step 7: Open Jupyter</b></h1>
Now, to open the web interface for Jupyter Notebook, use:

{% highlight ruby %}

~$ jupyter notebook

{% endhighlight %}

<h1><b>Step 8: Open a MicroPython Jupyter Notebook</b></h1>
To create a MicroPython file, click on "New" and select "MicroPython - USB" as the type of document to create.
Now, we should find ourselves in a blank Jupyter notebook. We can add cells to run with the plus (+) button, and then run cells with the play button to see how our code runs. Before we can do that, however, we'll need to add a cell to connect.

<h1><b>Step 9: Control Your Motor from the Web</b></h1>
In your Jupyter Notebook MicroPython file, use the following for the first block, making sure to use your serial port instead of mine;

{% highlight ruby %}

%serialconnect to --port=/dev/cu.wchusbserial14630 --baud=115200

{% endhighlight %}

Now, in our second block, let's create a small task to power on and off the motor;

{% highlight ruby %}

from machine import Pin
from time import sleep
motor = Pin(5, Pin.OUT)
motor.value(1)
sleep(0.2)
motor.value(0)
sleep(0.2)

{% endhighlight %}

You can also use .on() or .off() to control the pin:

{% highlight ruby %}

motor.on()
sleep(0.2)
motor.off()
sleep(0.2)

{% endhighlight %}

If you want to loop things, we can start to use different Python data structures

{% highlight ruby %}

from time import sleep
for i in range(10):
    motor.on()
    sleep(0.5)
    motor.off()
    sleep(0.5)

{% endhighlight %}

If you're a beginner or someone who already knows a little bit of Python, MicroPython is probably the best way to get started interacting with electronics from your laptop.